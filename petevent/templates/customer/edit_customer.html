{% extends "layout.html" %}

{% block title %}
Edit Customer
{% endblock %}

{% block script %}
<script>
// Thank you, viacep: https://viacep.com.br/exemplo/javascript/
function limpa_formulário_cep() {
        //Limpa valores do formulário de cep.
        document.getElementById('rua').value=("");
        document.getElementById('bairro').value=("");
        document.getElementById('cidade').value=("");
        document.getElementById('uf').value=("");
}

function meu_callback(conteudo) {
    if (!("erro" in conteudo)) {
        //Atualiza os campos com os valores.
        document.getElementById('rua').value=(conteudo.logradouro);
        document.getElementById('bairro').value=(conteudo.bairro);
        document.getElementById('cidade').value=(conteudo.localidade);
        document.getElementById('uf').value=(conteudo.uf);
    } //end if.
    else {
        //CEP não Encontrado.
        limpa_formulário_cep();
        alert("CEP not found.");
    }
}

function pesquisacep(valor) {

    //Nova variável "cep" somente com dígitos.
    var cep = valor.replace(/\D/g, '');

    //Verifica se campo cep possui valor informado.
    if (cep != "") {

        //Expressão regular para validar o CEP.
        var validacep = /^[0-9]{8}$/;

        //Valida o formato do CEP.
        if(validacep.test(cep)) {

            //Preenche os campos com "..." enquanto consulta webservice.
            document.getElementById('rua').value="...";
            document.getElementById('bairro').value="...";
            document.getElementById('cidade').value="...";
            document.getElementById('uf').value="...";

            //Cria um elemento javascript.
            var script = document.createElement('script');

            //Sincroniza com o callback.
            script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';

            //Insere script no documento e carrega o conteúdo.
            document.body.appendChild(script);

        } //end if.
        else {
            //cep é inválido.
            limpa_formulário_cep();
            alert("Invalid CEP format.");
        }
    } //end if.
    else {
        //cep sem valor, limpa formulário.
        limpa_formulário_cep();
    }
};
</script>
{% endblock %}

{% block links %}
<div class="collapse navbar-collapse" id="navbar">
    <ul class="navbar-nav mr-auto mt-2">
        <li class="nav-link"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-link"><a class="nav-link" href="/event/new_event">New event</a></li>
    </ul>
    <ul class="navbar-nav ml-auto mt-2">
        <li class="nav-link"><a class="nav-link" href="/customer/new_customer">New customer</a></li>
        <li class="nav-link"><a class="nav-link" href="/customer/customers">Customers</a></li>
        <li class="nav-link"><a class="nav-link" href="/pet/pets">Pets</a></li>
    </ul>
</div>
{% endblock %}

{% block header %}
Edit Customer
{% endblock %}

{% block main %}
<form action="" method="POST">
    <div class="form-group">
        <input name="id" hidden value="{{ id }}" type="text">
        <label>Name:
            <br>
            <input autocomplete="off" autofocus name="name" class="form-control" placeholder="Name" value="{{ name }}"
                   type="text" style="width: 300%;" required></label>
        <br/>
        <br/>
        <label>Phone number:
            <br>
            <input autocomplete="off" name="phone" placeholder="(11) 99999-9999" class="form-control sp_celphones"
                   maxlength="15" value="{{ phone }}" type="tel"></label>
        <br>
        <br>
        <label for="email">E-mail:
            <br>
            <input autocomplete="off" name="email" id="email" placeholder="customer@domain.com" style="width: 300%;"
                   class="form-control" value="{{ email }}" type="text"></label>
    </div>
    <br>
    <br>

    <div class="form-group address">
        <h2>Address Information:</h2>
        <br>
        <div class="input-group mb-3">
            <label for="cep">ZIP Code:
                <br>
                <input type="text" class="form-control cep" id="cep" name="zip_code" placeholder="00000-000"
                       maxlength="9" value="{{ zip_code }}" onblur="pesquisacep(this.value);"
                       style="width:90%;"></label>
            <label for="location">Logradouro:
                <br>
                <input autocomplete="off" name="location" id="location" placeholder="Rua, Av., etc"
                       class="form-control"
                       value="{{ location }}" type="text" style="width:300%;" required></label>
        </div>
        <br>
        <div class="input-group mb-3">
            <label>Número:
                <br>
                <input type="text" name="number" placeholder="Número" autocomplete="off" style="width:90%;"
                       class="form-control" value="{{ number }}"></label><br/>

            <label>Complemento:
                <br>
                <input type="text" name="complement" placeholder="Complemento" autocomplete="off"
                       style="width:300%;" class="form-control" value="{{ complement }}"></label><br/>
        </div>

        <br>

        <div class="input-group mb-3">

            <label>Bairro:
                <br>
                <input type="text" name="district" placeholder="Bairro" autocomplete="off" id="bairro"
                       style="width:150%;" class="form-control" value="{{ district }}" required></label><br/>
            <br>
            <span class="input-space"></span>

            <label>Cidade:
                <br>
                <input type="text" name="city" placeholder="Cidade" autocomplete="off" id="cidade"
                       style="width:90%;" class="form-control" value="{{ city }}" required></label><br/>
            <br>
            <label>Estado:
                <br>
                <input type="text" name="state" placeholder="UF" autocomplete="off" id="uf" style="width:30%;"
                       class="form-control" value="{{ state }}" required></label><br/>
        </div>
    </div>

    <br>
    <br>
    <input type="submit" class="btn btn-lg btn-secondary submit" name="action" value="Confirm">
    <input type="submit" class="btn btn-lg btn-secondary submit" name="action" value="Cancel">
</form>
{% endblock %}